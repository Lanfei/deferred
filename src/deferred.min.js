!function(a){function b(a,b){var c,d,e,f=Object.prototype.toString.call(a);if("[object Array]"===f||"[object Arguments]"===f)for(c=0,d=a.length;d>c;++c)b(a[c],c);else if(Object.keys){var g=Object.keys(a);for(c=0,d=g.length;d>c;++c)e=g[c],b(a[e],e)}else for(e in a)b(a[e],e)}function c(a){var d="pending",e={done:{emitter:"resolve",state:"resolved",callbacks:[],args:null},fail:{emitter:"reject",state:"rejected",callbacks:[],args:null},progress:{emitter:"notify",state:"pending",callbacks:[]}},f={always:function(a){return this.done(a).fail(a)},then:function(a,b,c){return this.done(a).fail(b).progress(c)},pipe:function(a,d,g){var h=0,i=arguments,j=c();return b(e,function(a,b){var c=i[h++];f[b](function(){if(c){var b=c.apply(f,arguments);void 0!==b&&null!==b&&j[a.emitter](b)}else j[a.emitter].apply(null,arguments)})}),j.promise()},state:function(){return d}},g={promise:function(){return f}};if(b(e,function(a,b){var c=a.callbacks;f[b]=function(b){return"pending"!==d&&d===a.state?b.apply(f,a.args):b&&c.push(b),f},g[a.emitter]=function(){if("pending"===d){for(var b=0,e=c.length;e>b;++b)c[b].apply(f,arguments);d=a.state,a.args=arguments,"pending"!==d&&(a.callbacks=null)}}}),a){var h=Array.prototype.slice.call(arguments,1);return a.apply(g,h),g.promise()}return g}c.version="2.0.0",c.when=function(a){var d=[],e=c(),f=arguments.length,g=f;return b(arguments,function(a,b){"function"==typeof a&&(a=a(c())),a.done(function(){d[b]=arguments,0===--g&&e.resolve.apply(null,d)}),a.fail(function(){e.reject.apply(null,arguments)})}),e.promise()},c.promisify=function(a,b){return function(){var d=new c,e=Array.prototype.slice.call(arguments);return b=b!==!1,e.push(function(a){if(b&&a)d.reject(a);else{var c=Array.prototype.slice.call(arguments,b?1:0);d.resolve.apply(null,c)}}),a.apply(this,e),d.promise()}},c.fromStream=function(a){var b=new c;return a.on("data",b.notify),a.on("end",b.resolve),a.on("error",b.reject),b.promise()},c.Deferred=c,"function"==typeof define?define.cmd?define(function(){return c}):define.amd&&define("deferred",[],function(){return c}):"object"==typeof module&&"object"==typeof module.exports?module.exports=c:a.Deferred=c}(this);