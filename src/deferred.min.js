!function(a){var b=function(a,b){for(var c in a)b(a[c],c)},c=function(a){var d="pending",e={done:{emiter:"resolve",state:"resolved",callbacks:[],args:null},fail:{emiter:"reject",state:"rejected",callbacks:[],args:null},progress:{emiter:"notify",state:"pending",callbacks:[]}},f={always:function(){f.done(a).fail(a)},then:function(){var a=0,d=arguments,g=c();return b(e,function(b,c){var e=d[a++];f[c](function(){e?g[b.emiter](e.apply(f,arguments)):g[b.emiter].apply(null,arguments)})}),g.promise()},pipe:function(a){var b=c();return f.done(function(){var d=a.apply(null,arguments);"function"==typeof d&&(d=d(c())),d.done(b.resolve).fail(b.reject).progress(b.notify)}),b.promise()},state:function(){return d}},g={promise:function(){return f}};return b(e,function(a,b){var c=a.callbacks;f[b]=function(b){return"pending"!==d&&d===a.state?b.apply(f,a.args):b&&c.push(b),f},g[a.emiter]=function(){if("pending"===d){for(var b=0,e=c.length;e>b;++b)c[b].apply(f,arguments);d=a.state,a.args=arguments,"pending"!==d&&(a.callbacks=null)}}}),a?a.call(g,g):g};c.when=function(a){for(var b=c(),d=arguments.length,e=d,f=0;d>f;++f)a=arguments[f],"function"==typeof a&&(a=a(c())),a.done(function(){0===--e&&b.resolve()}),a.fail(function(){b.reject()});return b.promise()},c.version="1.2.0","function"==typeof define?define.cmd?define(function(){return c}):define.amd&&define("deferred",[],function(){return c}):"object"==typeof module&&"object"==typeof module.exports?module.exports=c:a.Deferred=c}(this);